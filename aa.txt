import { Suspense } from "react";
import type { Metadata } from "next";
import Link from "next/link";
import TerminationCalculator from "@/components/calculators/TerminationCalculator";
import AdUnit from "@/components/ads/AdUnit";
import DisclaimerBox from "@/components/ui/DisclaimerBox";
import { 
  Briefcase, HelpCircle, History, BookOpen, 
  AlertTriangle, CheckCircle2, Coins, Calculator, 
  Wallet, FileText, Scale, Check, XCircle
} from "lucide-react";

// --- METADATA (SEO) ---
export const metadata: Metadata = {
  title: "Calculadora de Rescisão CLT 2025 | Cálculo Exato (Com Multa FGTS)",
  description: "Foi demitido? Simule seu acerto trabalhista completo: Aviso Prévio, Férias Proporcionais, 13º Salário e Multa de 40%. Ferramenta atualizada e gratuita.",
  keywords: ["calculadora rescisão", "calcular acerto", "simulador rescisão", "multa 40% fgts", "aviso prévio indenizado", "cálculo demissão"],
  alternates: { canonical: "https://mestredascontas.com.br/trabalhista/rescisao" },
  openGraph: {
    title: "Calculadora de Rescisão CLT 2025 - Mestre das Contas",
    description: "Simule seu acerto trabalhista agora. Descubra quanto você vai receber de rescisão.",
    url: "https://mestredascontas.com.br/trabalhista/rescisao",
    siteName: "Mestre das Contas",
    locale: "pt_BR",
    type: "article",
    images: [{ url: "/og-rescisao.png", width: 1200, height: 630, alt: "Simulador de Rescisão" }],
  },
};

// --- DADOS ESTRUTURADOS ---
const jsonLd = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "SoftwareApplication",
      "name": "Calculadora de Rescisão CLT",
      "applicationCategory": "FinanceApplication",
      "operatingSystem": "Web",
      "offers": { "@type": "Offer", "price": "0", "priceCurrency": "BRL" },
      "description": "Simulador de rescisão de contrato de trabalho com cálculo de todas as verbas rescisórias."
    },
    {
      "@type": "FAQPage",
      "mainEntity": [
        { "@type": "Question", "name": "Qual o prazo para pagamento?", "acceptedAnswer": { "@type": "Answer", "text": "Até 10 dias corridos após o término do contrato." } },
        { "@type": "Question", "name": "A multa de 40% é sobre o quê?", "acceptedAnswer": { "@type": "Answer", "text": "Sobre o total depositado pela empresa em sua conta do FGTS durante todo o contrato." } }
      ]
    }
  ]
};

type Props = { searchParams: Promise<{ [key: string]: string | string[] | undefined }> }

export default async function RescisaoPage({ searchParams }: Props) {
  const resolvedParams = await searchParams;
  const isEmbed = resolvedParams.embed === 'true';

  // --- MODO EMBED ---
  if (isEmbed) {
    return (
        <main className="w-full min-h-screen bg-white p-4 flex flex-col items-center justify-center font-sans">
            <div className="w-full max-w-2xl">
                <Suspense fallback={<div className="p-4 text-center">Carregando...</div>}>
                    <TerminationCalculator />
                </Suspense>
                <div className="mt-4 text-center">
                    <Link href="https://mestredascontas.com.br/trabalhista/rescisao" target="_blank" className="text-[10px] text-slate-400 hover:text-blue-600 uppercase font-bold tracking-wider">
                        Powered by Mestre das Contas
                    </Link>
                </div>
            </div>
        </main>
    );
  }

  // --- MODO COMPLETO ---
  return (
    <article className="flex flex-col gap-8 w-full max-w-full overflow-hidden px-4 sm:px-6 py-6 md:py-10">
      <script type="application/ld+json" dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }} />

      <header className="space-y-4 text-center md:text-left print:hidden max-w-4xl mx-auto md:mx-0">
        <span className="inline-flex items-center gap-2 py-1 px-3 rounded-full bg-blue-100 text-blue-700 text-[10px] md:text-xs font-bold uppercase tracking-wider mb-2 border border-blue-200">
          <Briefcase size={14} /> Direito Trabalhista
        </span>
        <h1 className="text-2xl sm:text-3xl md:text-5xl font-extrabold text-slate-900 tracking-tight leading-tight break-words">
          Calculadora de <span className="text-blue-600">Rescisão de Contrato</span>
        </h1>
        <p className="text-sm sm:text-base md:text-lg text-slate-600 max-w-3xl leading-relaxed mx-auto md:mx-0">
          Foi demitido ou vai pedir demissão? Simule agora o valor do seu acerto: <strong>Aviso Prévio</strong>, <strong>Férias</strong>, <strong>13º Salário</strong> e <strong>Multa do FGTS</strong>.
        </p>
      </header>

      {/* ANÚNCIO TOPO */}
      <div className="w-full max-w-full overflow-hidden flex justify-center bg-slate-50/50 rounded-lg border border-dashed border-slate-200/50 my-4 print:hidden">
         <AdUnit slot="rescisao_top" format="horizontal" variant="agency" className="min-h-[100px] w-full" />
      </div>

      <section id="ferramenta" className="scroll-mt-24 w-full max-w-full">
        <Suspense fallback={<div className="w-full h-96 bg-slate-50 rounded-xl animate-pulse"/>}>
           <TerminationCalculator />
        </Suspense>
        <div className="mt-8 print:hidden">
            <DisclaimerBox />
        </div>
      </section>

      <div className="w-full flex justify-center my-6 print:hidden">
        <AdUnit slot="rescisao_mid" format="auto" />
      </div>

      {/* --- CONTEÚDO SEO --- */}
      <div className="prose prose-sm md:prose-lg max-w-none bg-white p-6 md:p-10 rounded-2xl md:rounded-3xl border border-slate-100 shadow-sm overflow-hidden w-full print:hidden">
        
        <h2 className="text-2xl md:text-3xl font-bold text-slate-900 mb-6 flex items-center gap-2 border-l-4 border-blue-600 pl-4">
            Entenda o seu Acerto Trabalhista
        </h2>
        <p className="lead text-slate-700 text-lg">
          O momento da rescisão gera muitas dúvidas. São vários direitos somados que formam o valor final do seu "acerto".
          O valor depende de dois fatores principais: o <strong>motivo da saída</strong> (quem decidiu?) e o <strong>tempo de casa</strong>.
        </p>

        {/* LISTA DE VERBAS */}
        <div className="grid md:grid-cols-2 gap-6 my-8 not-prose">
            <div className="bg-slate-50 p-5 rounded-xl border border-slate-200">
                <h3 className="font-bold text-slate-800 flex items-center gap-2 mb-2"><Wallet className="text-green-600" /> Saldo de Salário</h3>
                <p className="text-sm text-slate-600">Recebe pelos dias trabalhados no mês da saída.</p>
            </div>
            <div className="bg-slate-50 p-5 rounded-xl border border-slate-200">
                <h3 className="font-bold text-slate-800 flex items-center gap-2 mb-2"><FileText className="text-blue-600" /> Aviso Prévio</h3>
                <p className="text-sm text-slate-600">Se indenizado, recebe 1 salário + 3 dias por ano trabalhado.</p>
            </div>
            <div className="bg-slate-50 p-5 rounded-xl border border-slate-200">
                <h3 className="font-bold text-slate-800 flex items-center gap-2 mb-2"><Coins className="text-amber-600" /> Férias + 1/3</h3>
                <p className="text-sm text-slate-600">Vencidas e proporcionais, sempre com o terço constitucional.</p>
            </div>
            <div className="bg-slate-50 p-5 rounded-xl border border-slate-200">
                <h3 className="font-bold text-slate-800 flex items-center gap-2 mb-2"><Scale className="text-purple-600" /> Multa FGTS (40%)</h3>
                <p className="text-sm text-slate-600">Calculada sobre todo o valor depositado pela empresa durante o contrato.</p>
            </div>
        </div>

        {/* VOCÊ SABIA */}
        <div className="bg-blue-50/60 p-6 rounded-2xl border border-blue-100 my-10 not-prose relative overflow-hidden">
            <h3 className="text-xl font-bold text-blue-900 mb-4 flex items-center gap-2">
                <History size={24} className="text-blue-600"/> Você Sabia? A História da Multa de 40%
            </h3>
            <p className="text-sm md:text-base text-slate-700 leading-relaxed">
                A multa de 40% do FGTS nasceu com a <strong>Constituição de 1988</strong>. Antes, era barato demitir. A multa foi criada para proteger o trabalhador contra a "despedida arbitrária", tornando a demissão mais custosa para a empresa e garantindo um fôlego financeiro para quem perde o emprego.
            </p>
        </div>

        {/* TABELA COMPARATIVA */}
        <h3 className="text-xl font-bold text-slate-800 mt-8 mb-4">O que eu perco se pedir demissão?</h3>
        <div className="overflow-x-auto border rounded-xl border-slate-200 shadow-sm not-prose mb-8">
            <table className="w-full text-sm text-left">
                <thead className="bg-slate-100 text-slate-700 uppercase text-xs">
                    <tr>
                        <th className="px-4 py-3">Direito</th>
                        <th className="px-4 py-3 text-center bg-blue-50 text-blue-800">Demitido</th>
                        <th className="px-4 py-3 text-center bg-orange-50 text-orange-800">Pediu Demissão</th>
                    </tr>
                </thead>
                <tbody className="divide-y divide-slate-100">
                    <tr className="hover:bg-slate-50">
                        <td className="px-4 py-3 font-medium">Saldo / Férias / 13º</td>
                        <td className="px-4 py-3 text-center text-green-600 font-bold"><Check size={16} className="inline"/> Recebe</td>
                        <td className="px-4 py-3 text-center text-green-600 font-bold"><Check size={16} className="inline"/> Recebe</td>
                    </tr>
                    <tr className="hover:bg-slate-50">
                        <td className="px-4 py-3 font-medium">Aviso Prévio</td>
                        <td className="px-4 py-3 text-center text-green-600 font-bold">Recebe (se indenizado)</td>
                        <td className="px-4 py-3 text-center text-red-500 font-bold">Não recebe</td>
                    </tr>
                    <tr className="hover:bg-slate-50">
                        <td className="px-4 py-3 font-medium">Multa 40% FGTS</td>
                        <td className="px-4 py-3 text-center text-green-600 font-bold"><Check size={16} className="inline"/> Recebe</td>
                        <td className="px-4 py-3 text-center text-red-500 font-bold"><XCircle size={16} className="inline"/> Perde</td>
                    </tr>
                    <tr className="hover:bg-slate-50">
                        <td className="px-4 py-3 font-medium">Seguro Desemprego</td>
                        <td className="px-4 py-3 text-center text-green-600 font-bold"><Check size={16} className="inline"/> Recebe</td>
                        <td className="px-4 py-3 text-center text-red-500 font-bold"><XCircle size={16} className="inline"/> Perde</td>
                    </tr>
                </tbody>
            </table>
        </div>

        {/* FAQ */}
        <div className="mt-12 not-prose">
          <h3 className="text-xl font-bold text-slate-900 mb-6 flex items-center gap-2">
              <HelpCircle className="text-blue-600" /> Dúvidas Frequentes
          </h3>
          <div className="space-y-4">
            <details className="group bg-white p-5 rounded-xl border border-slate-200 shadow-sm cursor-pointer">
              <summary className="font-semibold text-slate-800 list-none flex justify-between items-center">
                Qual o prazo para pagamento?
                <span className="text-slate-400 group-open:rotate-180 transition-transform">▼</span>
              </summary>
              <p className="mt-3 text-slate-600 border-t border-slate-100 pt-3">
                Até <strong>10 dias corridos</strong> após o término do contrato. Se atrasar, a empresa paga multa de um salário.
              </p>
            </details>
            <details className="group bg-white p-5 rounded-xl border border-slate-200 shadow-sm cursor-pointer">
              <summary className="font-semibold text-slate-800 list-none flex justify-between items-center">
                Recebo multa do FGTS se optei pelo Saque Aniversário?
                <span className="text-slate-400 group-open:rotate-180 transition-transform">▼</span>
              </summary>
              <p className="mt-3 text-slate-600 border-t border-slate-100 pt-3">
                <strong>Sim!</strong> A multa de 40% é sobre o total histórico depositado, mas o saldo restante fica retido na conta.
              </p>
            </details>
          </div>
        </div>

        {/* LINKS FINAIS */}
        <div className="mt-12 pt-8 border-t border-slate-200 print:hidden not-prose">
          <p className="font-bold text-slate-900 mb-6 text-sm uppercase tracking-wider flex items-center gap-2">
             <CheckCircle2 size={16} className="text-green-500"/> Continue Calculando:
          </p>
          <div className="grid md:grid-cols-3 gap-4">
            <Link href="/financeiro/salario-liquido" className="flex flex-col p-5 bg-white border border-slate-200 rounded-xl hover:border-blue-400 hover:shadow-md transition-all group">
                <div className="bg-blue-100 w-10 h-10 rounded-lg flex items-center justify-center mb-3 text-blue-600"><Coins size={20}/></div>
                <span className="font-bold text-slate-800 text-lg">Salário Líquido</span>
                <span className="text-sm text-slate-500 mt-1">Descontos do mês</span>
            </Link>
            <Link href="/trabalhista/ferias" className="flex flex-col p-5 bg-white border border-slate-200 rounded-xl hover:border-amber-400 hover:shadow-md transition-all group">
                <div className="bg-amber-100 w-10 h-10 rounded-lg flex items-center justify-center mb-3 text-amber-600"><Briefcase size={20}/></div>
                <span className="font-bold text-slate-800 text-lg">Calculadora de Férias</span>
                <span className="text-sm text-slate-500 mt-1">Venda de 10 dias</span>
            </Link>
            <Link href="/saude/imc" className="flex flex-col p-5 bg-white border border-slate-200 rounded-xl hover:border-red-400 hover:shadow-md transition-all group">
                <div className="bg-red-100 w-10 h-10 rounded-lg flex items-center justify-center mb-3 text-red-600"><Calculator size={20}/></div>
                <span className="font-bold text-slate-800 text-lg">IMC Online</span>
                <span className="text-sm text-slate-500 mt-1">Cuide da sua saúde</span>
            </Link>
          </div>
        </div>

      </div>
    </article>
  );
}